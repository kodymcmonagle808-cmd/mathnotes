<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>USA Chat</title>
<style>
  body { font-family: Arial, sans-serif; background:#f0f0f0; margin:0; padding:0; }
  #chatContainer { width:100%; max-width:600px; margin:20px auto; background:#fff; border:1px solid #ccc; padding:10px; border-radius:8px; }
  #chatBox { height:400px; overflow-y:scroll; border:1px solid #ddd; padding:10px; background:#fafafa; }
  #messageInput { width:70%; padding:10px; margin-top:10px; }
  button { padding:10px; margin-left:5px; cursor:pointer; }
  .message { margin:5px 0; }
</style>
</head>
<body>
<div id="chatContainer">
  <h2>USA Chat</h2>
  <div id="chatBox"></div>
  <input type="text" id="messageInput" placeholder="Type a message...">
  <button onclick="sendMessage()">Send</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBigh36k4MZ2ilfTe9LkaNzMlJOV1rrEjw",
    authDomain: "math-notes-e367f.firebaseapp.com",
    databaseURL: "https://math-notes-e367f-default-rtdb.firebaseio.com",
    projectId: "math-notes-e367f",
    storageBucket: "math-notes-e367f.appspot.com",
    messagingSenderId: "566840885486",
    appId: "1:566840885486:web:a514e8b996b7295ab733ff",
    measurementId: "G-0TZ5LG6M6D"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const chatRef = db.ref("messages");

  const chatBox = document.getElementById('chatBox');
  const messageInput = document.getElementById('messageInput');

  // Simple bad words filter
  const badWords = ["badword1","badword2","badword3"];
  function filterMessage(msg){
    let filtered = msg;
    badWords.forEach(word => {
      const regex = new RegExp(word,'gi');
      filtered = filtered.replace(regex,'****');
    });
    return filtered;
  }

  // Load messages in real time
  chatRef.on('child_added', snapshot => {
    const msg = snapshot.val();
    const div = document.createElement('div');
    div.textContent = `[${new Date(msg.time).toLocaleTimeString()}] ${msg.text}`;
    div.className = "message";
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  });

  async function sendMessage(){
    let text = messageInput.value.trim();
    if(!text) return;

    // USA check
    try {
      const res = await fetch('https://ipapi.co/json/');
      const data = await res.json();
      if(data.country !== 'US'){
        alert("Only users from the USA can send messages.");
        return;
      }
    } catch(e){
      alert("Could not verify location.");
      return;
    }

    text = filterMessage(text);
    chatRef.push({ text, time: Date.now() });
    messageInput.value = "";
  }
</script>
</body>
</html>
